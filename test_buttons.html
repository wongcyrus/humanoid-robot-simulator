<!DOCTYPE html>
<html>
<head>
    <title>Button Test</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
    <style>
        body { font-family: Arial, sans-serif; padding: 20px; }
        button { padding: 10px 15px; margin: 5px; font-size: 16px; }
        #log { background: #f0f0f0; padding: 10px; height: 300px; overflow-y: scroll; margin-top: 20px; }
        .status { padding: 10px; margin: 10px 0; border-radius: 5px; }
        .connected { background: #d4edda; color: #155724; }
        .disconnected { background: #f8d7da; color: #721c24; }
    </style>
</head>
<body>
    <h1>🤖 Robot Button Test</h1>
    
    <div id="status" class="status disconnected">❌ Disconnected</div>
    
    <h2>Individual Robot Actions</h2>
    <button onclick="sendAction('robot_1', 'wave')">🤖 Robot 1 Wave</button>
    <button onclick="sendAction('robot_2', 'bow')">🤖 Robot 2 Bow</button>
    <button onclick="sendAction('robot_3', 'dance')">🤖 Robot 3 Dance</button>
    <button onclick="sendAction('robot_4', 'kung_fu')">🤖 Robot 4 Kung Fu</button>
    
    <h2>All Robots Actions</h2>
    <button onclick="sendAction('all', 'wave')">👥 All Wave</button>
    <button onclick="sendAction('all', 'dance')">👥 All Dance</button>
    <button onclick="sendAction('all', 'jump')">👥 All Jump</button>
    <button onclick="sendAction('all', 'stop')">🛑 Stop All</button>
    
    <h2>Debug Log</h2>
    <div id="log"></div>

    <script>
        const socket = io();
        const statusDiv = document.getElementById('status');
        const logDiv = document.getElementById('log');
        
        function log(message) {
            const time = new Date().toLocaleTimeString();
            logDiv.innerHTML += `[${time}] ${message}<br>`;
            logDiv.scrollTop = logDiv.scrollHeight;
            console.log(message);
        }
        
        socket.on('connect', () => {
            statusDiv.textContent = '✅ Connected to WebSocket';
            statusDiv.className = 'status connected';
            log('✅ WebSocket connected successfully');
        });
        
        socket.on('disconnect', () => {
            statusDiv.textContent = '❌ Disconnected from WebSocket';
            statusDiv.className = 'status disconnected';
            log('❌ WebSocket disconnected');
        });
        
        socket.on('action_result', (result) => {
            log(`📨 Action result: ${JSON.stringify(result, null, 2)}`);
            if (result.success) {
                log(`✅ Action successful for ${result.results.length} robot(s)`);
            } else {
                log(`❌ Action failed: ${result.error}`);
            }
        });
        
        socket.on('robot_states', (states) => {
            const activeRobots = Object.values(states).filter(robot => robot.current_action !== 'idle');
            if (activeRobots.length > 0) {
                log(`🤖 Active robots: ${activeRobots.map(r => r.robot_id + ':' + r.current_action).join(', ')}`);
            }
        });
        
        function sendAction(robotId, action) {
            log(`🎮 Button clicked: ${robotId} -> ${action}`);
            
            if (!socket.connected) {
                log('❌ WebSocket not connected!');
                return;
            }
            
            const actionData = {
                robot_id: robotId,
                action: action
            };
            
            log(`📤 Sending WebSocket message: ${JSON.stringify(actionData)}`);
            socket.emit('run_action', actionData);
        }
        
        // Test connection on page load
        setTimeout(() => {
            if (socket.connected) {
                log('🎯 Ready to test robot actions!');
            } else {
                log('⚠️ WebSocket connection failed - check server');
            }
        }, 1000);
    </script>
</body>
</html>
